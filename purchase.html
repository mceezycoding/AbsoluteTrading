<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A.B Trading — Purchase</title>
  <style>
    :root {
      --beige: #f5f5dc;
      --brown: #5c4033;
      --accent: #8b5e3c;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--beige);
      color: #333;
    }

    header {
      background: var(--brown);
      color: #fff;
      padding: 20px;
      text-align: center;
    }

    nav {
      background: var(--accent);
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 10px;
    }

    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }

    nav a:hover {
      text-decoration: underline;
    }

    .page-content {
      max-width: 980px;
      margin: 28px auto;
      padding: 18px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
    }

    .checkout-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    /* product summary */
    .product-box {
      border-radius: 8px;
      padding: 14px;
      background: #faf5ef;
      border: 1px solid rgba(0, 0, 0, 0.04);
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
    }

    .product-box img {
      width: 100%;
      max-width: 320px;
      height: 260px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid var(--brown);
    }

    .product-title {
      font-weight: 800;
      font-size: 1.15rem;
      color: var(--brown);
      margin: 6px 0;
      text-align: center;
    }

    .product-desc {
      color: #444;
      font-size: .98rem;
      text-align: center;
      margin: 0;
    }

    /* order form */
    form .field {
      margin-bottom: 12px;
    }

    label {
      display: block;
      margin-bottom: 6px;
      font-weight: 700;
      color: #333;
    }

    input[type="text"],
    input[type="email"],
    input[type="number"],
    select,
    textarea {
      width: 100%;
      padding: 10px;
      border-radius: 6px;
      border: 1px solid #d8cfc5;
      font-size: 1rem;
    }

    textarea {
      resize: vertical;
      min-height: 90px;
    }

    .options-row {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .small {
      flex: 1;
      min-width: 120px;
    }

    .summary {
      margin-top: 10px;
      padding: 12px;
      background: #fff6eb;
      border-radius: 8px;
      border: 1px solid rgba(0, 0, 0, 0.03);
      font-weight: 700;
      color: var(--brown);
    }

    .submit-btn {
      display: inline-block;
      margin-top: 12px;
      padding: 12px 18px;
      border-radius: 8px;
      background: var(--brown);
      color: #fff;
      border: 0;
      font-weight: 800;
      cursor: pointer;
    }

    .submit-btn:hover {
      background: var(--accent);
    }

    .muted {
      color: #666;
      font-size: .95rem;
    }

    /* responsive */
    @media (max-width: 820px) {
      .checkout-grid {
        grid-template-columns: 1fr;
      }
      .product-box img {
        max-width: 100%;
        height: 220px;
      }
    }
  </style>
</head>

<body>
  <header>
    <h1>A.B Trading</h1>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="shop.html">Shop</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
  </nav>

  <main class="page-content">
    <div class="checkout-grid">
      <!-- LEFT: Product preview -->
      <section class="product-box" id="productBox">
        <div style="text-align:center;">
          <div id="noProduct" style="padding:28px;">
            <p class="muted">No product selected yet.</p>
            <a href="shop.html"
               style="display:inline-block;margin-top:8px;padding:10px 14px;background:var(--accent);color:#fff;border-radius:6px;text-decoration:none;">
              Return to Shop
            </a>
          </div>
        </div>
      </section>

      <!-- RIGHT: Form and customization -->
      <section>
        <h2 style="margin-top:0">Complete your order</h2>

        <form id="purchaseForm">
          <!-- Hidden fields for product data -->
          <input type="hidden" name="productName" id="productNameInput">
          <input type="hidden" name="productPrice" id="productPriceInput">
          <input type="hidden" name="productImg" id="productImgInput">

          <!-- Customization options -->
          <div class="field">
            <label for="phoneModel">Phone Model</label>
            <select id="phoneModel" name="phoneModel" required>
              <option value="">Select model</option>
              <option value="iPhone">iPhone</option>
              <option value="Samsung">Samsung</option>
              <option value="Huawei">Huawei</option>
              <option value="Xiaomi">Xiaomi</option>
              <option value="Other">Other</option>
            </select>
          </div>

          <div class="field">
            <label for="color">Color / Variant</label>
            <select id="color" name="color">
              <option value="Default">Default</option>
              <option value="Beige">Beige</option>
              <option value="Brown">Brown</option>
              <option value="Marble">Marble</option>
              <option value="Leather">Leather</option>
            </select>
          </div>

          <div class="options-row">
            <div class="field small">
              <label for="quantity">Quantity</label>
              <input id="quantity" name="quantity" type="number" value="1" min="1">
            </div>

            <div class="field small">
              <label>&nbsp;</label>
              <div style="display:flex;gap:8px;">
                <label style="display:flex;align-items:center;gap:8px;">
                  <input type="checkbox" id="addonScreen" data-price="1.50">
                  Screen protector (+$1.50)
                </label>
                <label style="display:flex;align-items:center;gap:8px;">
                  <input type="checkbox" id="addonExpress" data-price="5.00">
                  Express shipping (+$5.00)
                </label>
              </div>
            </div>
          </div>

          <hr style="border:none;border-top:1px solid #eee;margin:14px 0;">

          <div class="field">
            <label for="fullName">Full name</label>
            <input id="fullName" name="fullName" type="text" required>
          </div>

          <div class="field">
            <label for="email">Email</label>
            <input id="email" name="email" type="email" required>
          </div>

          <div class="field">
            <label for="address">Shipping address</label>
            <textarea id="address" name="address"
                      placeholder="Street, city, postal code, country"
                      required></textarea>
          </div>

          <div class="field">
            <label for="payment">Payment method</label>
            <select id="payment" name="payment" required>
              <option value="">Choose a payment method</option>
              <option>Credit/Debit Card</option>
              <option>PayPal</option>
              <option>Mobile Money</option>
            </select>
          </div>

          <div class="summary" id="priceSummary">
            Subtotal: <span id="subtotal">$0.00</span><br>
            Total (incl. options): <span id="total">$0.00</span>
          </div>

          <button class="submit-btn" type="submit">Confirm Purchase</button>
        </form>

        <p class="muted" style="margin-top:12px;">
          Note: This demo page collects order info — link this to your payment processor or admin backend to process orders.
        </p>
      </section>
    </div>
  </main>

  <footer style="text-align:center;padding:16px;background:var(--brown);color:#fff;">
    &copy; 2025 A.B Trading. All rights reserved.
  </footer>

  <!-- EmailJS -->
  <script src="https://cdn.emailjs.com/dist/email.min.js"></script>

  <script>
    // Init EmailJS (replace with your real public key)
    emailjs.init("26lTbalaRS-kPjjNY");

    // Parse query params
    function parseQuery() {
      const q = {};
      const s = window.location.search.replace(/^\?/, '');
      if (!s) return q;
      s.split('&').forEach(part => {
        const [k, v = ''] = part.split('=');
        q[decodeURIComponent(k)] =
          decodeURIComponent((v || '').replace(/\+/g, ' '));
      });
      return q;
    }

    // Load product data
    function loadSelectedProduct() {
      const params = parseQuery();
      if (params.name || params.product) {
        return {
          name: params.name || params.product,
          price: parseFloat(params.price || params.p || 0) || 0,
          img: params.img || params.image || '',
        };
      }
      try {
        const raw = localStorage.getItem('selectedProduct');
        if (raw) return JSON.parse(raw);
      } catch (e) {}
      return null;
    }

    // Update UI
    const productBox = document.getElementById('productBox');
    const purchaseForm = document.getElementById('purchaseForm');
    const productNameInput = document.getElementById('productNameInput');
    const productPriceInput = document.getElementById('productPriceInput');
    const productImgInput = document.getElementById('productImgInput');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');

    function formatMoney(n) {
      return '$' + n.toFixed(2);
    }

    function showProduct(product) {
      productBox.innerHTML = '';
      const img = document.createElement('img');
      img.alt = product.name || 'Selected product';
      img.src = product.img || 'https://placehold.co/600x400/f5f5dc/5c4033?text=No+Image';

      const title = document.createElement('div');
      title.className = 'product-title';
      title.textContent = product.name || 'Selected product';

      const desc = document.createElement('p');
      desc.className = 'product-desc';
      desc.textContent = product.desc || 'You are purchasing this item.';

      const price = document.createElement('div');
      price.style.fontWeight = '800';
      price.style.color = 'var(--brown)';
      price.textContent = 'Base price: ' + formatMoney(product.price || 0);

      productBox.appendChild(img);
      productBox.appendChild(title);
      productBox.appendChild(desc);
      productBox.appendChild(price);

      productNameInput.value = product.name || '';
      productPriceInput.value = (product.price || 0);
      productImgInput.value = product.img || '';
    }

    // Price calculation
    function calculatePrice() {
      const base = parseFloat(productPriceInput.value || 0);
      const qty = Math.max(1, parseInt(document.getElementById('quantity').value || 1));

      let extras = 0;
      const addonScreen = document.getElementById('addonScreen');
      const addonExpress = document.getElementById('addonExpress');

      if (addonScreen && addonScreen.checked)
        extras += parseFloat(addonScreen.dataset.price || 0);
      if (addonExpress && addonExpress.checked)
        extras += parseFloat(addonExpress.dataset.price || 0);

      const subtotal = (base + extras) * qty;
      const total = subtotal;

      subtotalEl.textContent = formatMoney(subtotal);
      totalEl.textContent = formatMoney(total);

      return { subtotal, total, qty, extras };
    }

    // Init
    (function init() {
      const selected = loadSelectedProduct();
      if (selected) {
        selected.price = parseFloat(selected.price) || 0;
        showProduct(selected);
      }

      calculatePrice();

      ['quantity', 'addonScreen', 'addonExpress', 'color']
        .forEach(id => {
          const el = document.getElementById(id);
          if (el) el.addEventListener('change', calculatePrice);
        });

      purchaseForm.addEventListener('submit', function (e) {
        e.preventDefault();
        const summary = calculatePrice();

        const order = {
          productName: productNameInput.value,
          productPrice: parseFloat(productPriceInput.value || 0),
          phoneModel: document.getElementById('phoneModel').value,
          color: document.getElementById('color').value,
          quantity: summary.qty,
          extras: summary.extras,
          subtotal: summary.subtotal,
          total: summary.total,
          fullName: document.getElementById('fullName').value,
          email: document.getElementById('email').value,
          address: document.getElementById('address').value,
          paymentMethod: document.getElementById('payment').value,
          createdAt: new Date().toLocaleString()
        };

        // Send to EmailJS
        emailjs.send("service_id9vj5n", "template_pn0lrb9", order)
          .then(() => {
            alert("✅ Order sent successfully! Check your email inbox.");
            localStorage.setItem('lastOrder', JSON.stringify(order));
            localStorage.removeItem('selectedProduct');
            purchaseForm.reset();
            calculatePrice();
          })
          .catch((err) => {
            console.error("EmailJS Error:", err);
            alert("❌ Failed to send order. Please try again.");
          });
      });
    })();
  </script>
</body>
</html>
